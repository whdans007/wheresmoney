# 탈퇴 후 재가입 문제 완전 해결 가이드

## 🚨 현재 상황: 탈퇴 후 재가입이 안 됨

탈퇴 처리 후에도 Supabase에 사용자 데이터가 남아있어서 "이미 등록된 이메일입니다" 오류가 발생하는 상황

## 📋 단계별 해결 방법

### 1단계: 현재 상태 진단

**Supabase SQL Editor에서 실행:**
1. `CHECK_USER_STATUS.sql` 파일 열기
2. 파일 내의 이메일 주소를 문제되는 실제 이메일로 변경
3. 전체 스크립트 실행하여 어떤 데이터가 남아있는지 확인

```sql
-- 예시: 이 부분을 실제 이메일로 변경
check_email TEXT := '문제되는이메일@example.com';
```

### 2단계: 완전 데이터 삭제

**상태 진단에서 데이터가 남아있다고 나온 경우:**
1. `COMPLETE_USER_CLEANUP.sql` 파일 열기
2. 파일 내의 이메일 주소를 실제 이메일로 변경
3. 전체 스크립트 실행

```sql
-- 예시: 이 부분을 실제 이메일로 변경
problem_email TEXT := '문제되는이메일@example.com';
```

### 3단계: 삭제 완료 확인

**SQL로 확인:**
```sql
-- 완전히 삭제되었는지 최종 확인
SELECT 
  'auth.users' as location, 
  COUNT(*) as remaining_records 
FROM auth.users 
WHERE email = '확인할이메일@example.com'

UNION ALL

SELECT 
  'public.users' as location, 
  COUNT(*) as remaining_records 
FROM public.users 
WHERE email = '확인할이메일@example.com';

-- 결과: 둘 다 0이어야 함
```

### 4단계: 재가입 테스트

**앱에서 테스트:**
1. 해당 이메일로 새로운 회원가입 시도
2. "이미 등록된 이메일" 오류가 나오지 않아야 함
3. 정상적으로 인증 이메일이 발송되어야 함

## 🔧 추가 확인사항

### Supabase 이메일 설정 확인
**다음 설정들이 올바른지 확인:**
1. **Authentication** → **Settings** → **Email**
2. **"Enable email confirmations"** 체크 활성화
3. **SMTP 설정** 올바른지 확인 (기본값 사용 권장)

### 브라우저/앱 캐시 정리
1. 브라우저 캐시 및 쿠키 삭제
2. 앱 완전 종료 후 재시작
3. 가능하면 다른 기기에서도 테스트

## 🚀 예상 결과

### 성공적인 경우:
- ✅ SQL 실행 결과: "성공: 이메일로 재가입 가능합니다!"
- ✅ 확인 쿼리 결과: 모든 테이블에서 0개 레코드
- ✅ 앱에서 회원가입: 정상적으로 진행됨
- ✅ 인증 이메일: 정상 발송됨

### 여전히 문제가 있는 경우:
1. **수동 확인**: Supabase 대시보드 → Authentication → Users에서 직접 확인
2. **강제 삭제**: SQL에서 `DELETE FROM auth.users WHERE email = '이메일';` 직접 실행
3. **지원 요청**: Supabase 지원팀에 문의

## 📝 문제 해결 체크리스트

- [ ] 1단계: 현재 상태 진단 완료
- [ ] 2단계: 완전 데이터 삭제 실행 완료  
- [ ] 3단계: 삭제 완료 확인 (모든 테이블에서 0개)
- [ ] 4단계: 재가입 테스트 성공
- [ ] 추가: Supabase 이메일 설정 확인
- [ ] 추가: 캐시 정리 완료

## ⚠️ 주의사항

- **백업**: 프로덕션에서는 반드시 백업 후 진행
- **테스트**: 테스트 환경에서 먼저 검증
- **권한**: SQL 실행 권한이 있는 관리자 계정으로 진행
- **확인**: 각 단계마다 결과 확인 후 다음 단계 진행

이 가이드를 따라하면 탈퇴 후 재가입 문제가 완전히 해결됩니다!